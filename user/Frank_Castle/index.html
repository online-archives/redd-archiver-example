<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- SEO Meta Tags -->
<meta name="description" content="View 7 archived posts by u/Frank_Castle in v/programming">
<meta name="keywords" content="reddit, user, posts, archive, Frank_Castle, programming">
<meta name="author" content="Redd Archive Demo">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://online-archives.github.io/redd-archiver-example/user/Frank_Castle/">

<!-- Open Graph Tags -->
<meta property="og:title" content="u/Frank_Castle - 7 Archived Voat Posts in v/programming">
<meta property="og:description" content="View 7 archived posts by u/Frank_Castle in v/programming">
<meta property="og:type" content="profile">
<meta property="og:url" content="https://online-archives.github.io/redd-archiver-example/user/Frank_Castle/">
<meta property="og:site_name" content="Redd Archive Demo">

<!-- Twitter Card Tags -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="u/Frank_Castle - 7 Archived Voat Posts in v/programming">
<meta name="twitter:description" content="View 7 archived posts by u/Frank_Castle in v/programming">

    <!-- Favicon -->
<link rel="icon" href="../../static/favicon.ico" sizes="32x32">
    <link rel="icon" href="../../static/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="../../static/apple-touch-icon.png">
    <link rel="manifest" href="../../static/site.webmanifest">

    <!-- Font preload removed - using system fonts for instant rendering -->

    <!-- Theme Toggle -->
    <input type="checkbox" id="dark-theme-toggle">

    <!-- Universal CSS Build -->
    <link rel="stylesheet" href="../../static/css/redd-archiver-universal.css">


    <title>u/Frank_Castle - 7 Archived Voat Posts in v/programming</title>
  </head>
  <body>
    <div class="site-content">
<header>
  <nav class="navbar navbar-expand-sm navbar-dark bg-primary">
    <a class="navbar-brand" href="./">u/Frank_Castle</a>
    <input type="checkbox" id="navbar-toggle" class="navbar-toggle">
    <label for="navbar-toggle" class="navbar-toggler" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </label>
    <div class="navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="../../index.html">home</a>
        </li>
        <li class="nav-item ">
          <a class="nav-link" href="../../search">search</a>
        </li>
        <li class="nav-item">
          <label for="dark-theme-toggle" class="nav-link theme-toggle" title="Toggle dark theme"></label>
        </li>
      </ul>
    </div>
  </nav>
</header>

    <main role="main" class="container-fluid">
<div class="user-profile-header pt-3">
  <h2>u/Frank_Castle</h2>
  <p class="lead">
    4 posts ·
    3 comments ·
    7 total
  </p>
  <p class="text-muted">Active in: v/programming (7)</p>
</div>

<ul class="pagination pagination-sm mt-3">
  <li class="page-item first-page disabled"><a class="page-link" href="index.html" tabindex="-1">&lsaquo;&lsaquo;&lsaquo;</a></li>

  <li class="page-item skip-back disabled"><a class="page-link" href="index.html" tabindex="-1">&lsaquo;&lsaquo;</a></li>

  <li class="page-item prev-page disabled"><a class="page-link" href="index-0.html" tabindex="-1">&lsaquo;</a></li>


      <li class="page-item active"><a class="page-link" href="index.html">1</a></li>

  <li class="page-item next-page disabled"><a class="page-link" href="index-1.html" tabindex="-1">&rsaquo;</a></li>

  <li class="page-item skip-forward disabled"><a class="page-link" href="index.html" tabindex="-1">&rsaquo;&rsaquo;</a></li>

  <li class="page-item last-page disabled"><a class="page-link" href="index.html" tabindex="-1">&rsaquo;&rsaquo;&rsaquo;</a></li>
</ul>


<div class="links">

<div class="link mt-3">
    <h6 class="comment-context mb-1">
        <small class="text-muted">
            Comment on: <a href="../../v/programming/comments/2477837#12359335">C++ Will No Longer Have Pointers</a>
        </small>
    </h6>
    <div class="comment-body mb-2 p-2 bg-light rounded"><p>It may have gotten the hug of death. <a href="https://webcache.googleusercontent.com/search?q=cache:VmykuKC8FlsJ:https://www.fluentcpp.com/2018/04/01/cpp-will-no-longer-have-pointers/+&amp;cd=1&amp;hl=en&amp;ct=clnk&amp;gl=us">Here's a cached version.</a></p></div>
    <a href="../../v/programming/comments/2477837#12359335">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
    </a>
    <small class="text-muted">
        <span title="Posted: 2018-04-01 15:41:21 UTC">01 Apr 2018 15:41</span>
        <span ><a class="user-link" href="../../user/Frank_Castle/">u/Frank_Castle</a>
</span>
        
        
        in <a href="../../v/programming/">v/programming</a>
    </small>
</div>
<div class="link mt-3">
    <h5 class="title mb-0">
        <a href="../../v/programming/comments/2477837/">C++ Will No Longer Have Pointers</a>
        
        
        
    </h5>
    <a href="../../v/programming/comments/2477837/">
        <span class="badge badge-success"
              title="Score: 1">
            1
        </span>
    </a>
    <small class="text-muted">
        <a href="../../v/programming/comments/2477837/">0 comments</a>
        <span title="Posted: 2018-04-01 15:27:18 UTC">01 Apr 2018 15:27</span>
        <span ><a class="user-link" href="../../user/Frank_Castle/">u/Frank_Castle</a>
</span>
        
        
        <span title="../../v/programming/comments/2477837/"><a href="../../v/programming/comments/2477837/" class="link-domain" title="../../v/programming/comments/2477837/">(..)</a></span>
        in <a href="../../v/programming/">v/programming</a>
    </small>
</div>
<div class="link mt-3">
    <h6 class="comment-context mb-1">
        <small class="text-muted">
            Comment on: <a href="../../v/programming/comments/2474107#12352857">Linus Torvalds - &#34;That is either genius, or a seriously diseased mind.&#34;</a>
        </small>
    </h6>
    <div class="comment-body mb-2 p-2 bg-light rounded"><p>Linus' email already does it pretty well, honestly, I'm not sure how much more you can break that apart. Apparently there's some rule in the C standard that the type of a ternary operator expression (condition ? result_when_true : result_when_false) is equal to the type of result_when_true in the way it's used here except when that is the NULL constant ((void *)0), in which case it is equal to the type of result_when_false. The macro abuses this my making sure the result_when_true side of the operator will always be NULL (by multiplying with 0 and casting to (void *)) so that the only part that still influences it is whether the argument (x) is constant.</p>
<p>If it was constant, you're left with the result_when_false part which is sizeof(*(int *)). This is obviously equal to sizeof(int), since derefencing an int pointer makes an int. If it wasn't constant, the compiler instead looks at the type of the result_when_true part, which gives you sizeof(*(void *)). The size of the void type (from dereferencing a void pointer) is undefined in the C standard, but GCC has an extension to say that it is always 1 (because people often use (void *) as &quot;generic&quot; pointers to buffers where you don't really care what their contents are, and when you do pointer arithmetic on those it makes most sense to just count them as individual bytes). So the equation ends up as (sizeof(int) == 1), which is false (int can be anywhere between 2 and 8 bytes depending on the platform and compiler configuration, but it is never 1).</p></div>
    <a href="../../v/programming/comments/2474107#12352857">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
    </a>
    <small class="text-muted">
        <span title="Posted: 2018-03-31 17:36:40 UTC">31 Mar 2018 17:36</span>
        <span ><a class="user-link" href="../../user/Frank_Castle/">u/Frank_Castle</a>
</span>
        
        
        in <a href="../../v/programming/">v/programming</a>
    </small>
</div>
<div class="link mt-3">
    <h6 class="comment-context mb-1">
        <small class="text-muted">
            Comment on: <a href="../../v/programming/comments/2474107#12337241">Linus Torvalds - &#34;That is either genius, or a seriously diseased mind.&#34;</a>
        </small>
    </h6>
    <div class="comment-body mb-2 p-2 bg-light rounded"><p>In C, it can be useful to have a way to test whether a certain value is known at compile-time or not. That is what this crazy-ass macro does through arcane abuse of C evaluation rules.</p>
<p>Consider you have some common thing you need to do in your program which does a lot of arithmetic, like this:</p>
<pre><code>int myfunc(int value)
{
    return ((value * 1032443897) / 35468 + 934) / 34 - 34673264;
}
</code></pre>
<p>That's a lot of math operations. I mean, a modern processor still eats it in a couple of nanoseconds, probably, but if you need to do this a lot in time-critical code it might add up. The thing is, maybe in some cases you want to call it on a constant value, like this:</p>
<pre><code>int myvalue = myfunc(3948);
</code></pre>
<p>In this case, the 3948 is compile-time constant, so the compiler could do all the math at compile time and just write the fully calculated end result right into the program binary. There would be no more cost at runtime. However, if you just call the function like that it won't do this, because C compilers usually only translate one source file at a time (ignoring a fancy new thing called LTO for a second), and so if myfunc() is defined in a different source file than the code that calls it, the compiler doesn't have the knowledge of how to do the calculation in its head at the same time as it sees the constant. It has to generate a normal function call that calculates the result at runtime.</p>
<p>In order to fix this, you can write a macro like this:</p>
<pre><code>#define mymacro(x) (((value * 1032443897) / 35468 + 934) / 34 - 34673264)
</code></pre>
<p>Macros go into header files (meaning they're essentially a part of every source file they're needed in) and are always fully evaluated by the compiler at the time they're invoked. So now when you write</p>
<pre><code>int value = mymacro(3948);
</code></pre>
<p>you can be sure that the compiler will do all the math it can with that value and calculate the final result at compile-time.</p>
<p>But, alas, what happens if the input parameter is not a constant? Let's say you have a function like this:</p>
<pre><code>void somefunction(int input)
{
    int value = mymacro(input);
    ...do something cool with the value...
}
</code></pre>
<p>Now the compiler cannot do all the math at compile time, and instead has to generate code into somefunction() to do it at runtime. If you have 20 different functions that all do this, that code will be duplicated 20 times in your program, making it bloated and slow (larger programs have worse instruction cache efficiency). For that case, you would rather just call myfunction() so that all these other functions only include a small function call instruction to myfunction(), and then myfunction() contains the code to actually do the math only once.</p>
<p>Of course, you can just pay attention when programming and make sure you always use mymacro() or myfunction() depending on whether the input parameter is constant or not. But that is annoying and error prone, and sometimes it can actually be kinda difficult to tell whether the compiler considers a value constant or not. It would be much nicer if the compiler could just make that decision for you. With Mr. Uecker's insane new creation, you can:</p>
<pre><code>#define mycalc(x) if (ICE_P(x)) mymacro(x); else myfunction(x)
</code></pre>
<p>Now you just use mycalc() throughout your code whenever you want to do the calculation, and the compiler will either do all the math at compile-time if it can, or output a function call to the single copy of the calculation code that's in your program binary.</p></div>
    <a href="../../v/programming/comments/2474107#12337241">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
    </a>
    <small class="text-muted">
        <span title="Posted: 2018-03-30 02:34:23 UTC">30 Mar 2018 02:34</span>
        <span ><a class="user-link" href="../../user/Frank_Castle/">u/Frank_Castle</a>
</span>
        
        
        in <a href="../../v/programming/">v/programming</a>
    </small>
</div>
<div class="link mt-3">
    <h5 class="title mb-0">
        <a href="../../v/programming/comments/2474107/">Linus Torvalds - &#34;That is either genius, or a seriously diseased mind.&#34;</a>
        
        
        
    </h5>
    <a href="../../v/programming/comments/2474107/">
        <span class="badge badge-success-bright"
              title="Score: 4">
            4
        </span>
    </a>
    <small class="text-muted">
        <a href="../../v/programming/comments/2474107/">0 comments</a>
        <span title="Posted: 2018-03-30 01:34:27 UTC">30 Mar 2018 01:34</span>
        <span ><a class="user-link" href="../../user/Frank_Castle/">u/Frank_Castle</a>
</span>
        
        
        <span title="../../v/programming/comments/2474107/"><a href="../../v/programming/comments/2474107/" class="link-domain" title="../../v/programming/comments/2474107/">(..)</a></span>
        in <a href="../../v/programming/">v/programming</a>
    </small>
</div>
<div class="link mt-3">
    <h5 class="title mb-0">
        <a href="../../v/programming/comments/2474100/">Old reddit source code</a>
        
        
        
    </h5>
    <a href="../../v/programming/comments/2474100/">
        <span class="badge badge-success"
              title="Score: 1">
            1
        </span>
    </a>
    <small class="text-muted">
        <a href="../../v/programming/comments/2474100/">1 comment</a>
        <span title="Posted: 2018-03-30 01:29:48 UTC">30 Mar 2018 01:29</span>
        <span ><a class="user-link" href="../../user/Frank_Castle/">u/Frank_Castle</a>
</span>
        
        
        <span title="../../v/programming/comments/2474100/"><a href="../../v/programming/comments/2474100/" class="link-domain" title="../../v/programming/comments/2474100/">(..)</a></span>
        in <a href="../../v/programming/">v/programming</a>
    </small>
</div>
<div class="link mt-3">
    <h5 class="title mb-0">
        <a href="../../v/programming/comments/255438/">The AI Games - Create a bot for Tetris and join the competition!</a>
        
        
        
    </h5>
    <a href="../../v/programming/comments/255438/">
        <span class="badge badge-success"
              title="Score: 1">
            1
        </span>
    </a>
    <small class="text-muted">
        <a href="../../v/programming/comments/255438/">0 comments</a>
        <span title="Posted: 2015-07-11 21:19:57 UTC">11 Jul 2015 21:19</span>
        <span ><a class="user-link" href="../../user/Frank_Castle/">u/Frank_Castle</a>
</span>
        
        
        <span title="../../v/programming/comments/255438/"><a href="../../v/programming/comments/255438/" class="link-domain" title="../../v/programming/comments/255438/">(..)</a></span>
        in <a href="../../v/programming/">v/programming</a>
    </small>
</div></div>

<ul class="pagination pagination-sm mt-3">
  <li class="page-item first-page disabled"><a class="page-link" href="index.html" tabindex="-1">&lsaquo;&lsaquo;&lsaquo;</a></li>

  <li class="page-item skip-back disabled"><a class="page-link" href="index.html" tabindex="-1">&lsaquo;&lsaquo;</a></li>

  <li class="page-item prev-page disabled"><a class="page-link" href="index-0.html" tabindex="-1">&lsaquo;</a></li>


      <li class="page-item active"><a class="page-link" href="index.html">1</a></li>

  <li class="page-item next-page disabled"><a class="page-link" href="index-1.html" tabindex="-1">&rsaquo;</a></li>

  <li class="page-item skip-forward disabled"><a class="page-link" href="index.html" tabindex="-1">&rsaquo;&rsaquo;</a></li>

  <li class="page-item last-page disabled"><a class="page-link" href="index.html" tabindex="-1">&rsaquo;&rsaquo;&rsaquo;</a></li>
</ul>

    </main>

<footer class="container-fluid">
  <p class="small mb-0">
    archive has 9,592 posts and 65,719 comments.
    <a href="https://github.com/19-84/redd-archiver">source code</a>.
  </p>
</footer>
    </div>

  </body>
</html>