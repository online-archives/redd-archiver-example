<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- SEO Meta Tags -->
<meta name="description" content="I&#39;m trying to fake the curvature of a planet using a fisheye post-processing effect, but in doing so, I&#39;ll need to transform the rays being... - v/programming">
<meta name="keywords" content="programming, oneoverbasesize, ray, fisheye, pre, code, hit, from, screen, like">
<meta name="author" content="Redd Archive Demo">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://online-archives.github.io/redd-archiver-example/v/programming/comments/1539795.html">

<!-- Open Graph Tags -->
<meta property="og:title" content="v/programming: Fisheye Raycasting">
<meta property="og:description" content="I&#39;m trying to fake the curvature of a planet using a fisheye post-processing effect, but in doing so, I&#39;ll need to transform the rays being... - v/programming">
<meta property="og:type" content="article">
<meta property="og:url" content="https://online-archives.github.io/redd-archiver-example/v/programming/comments/1539795.html">
<meta property="og:site_name" content="Redd Archive Demo">

<!-- Twitter Card Tags -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="v/programming: Fisheye Raycasting">
<meta name="twitter:description" content="I&#39;m trying to fake the curvature of a planet using a fisheye post-processing effect, but in doing so, I&#39;ll need to transform the rays being... - v/programming">

    <!-- Favicon -->
<link rel="icon" href="../../../../static/favicon.ico" sizes="32x32">
    <link rel="icon" href="../../../../static/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="../../../../static/apple-touch-icon.png">
    <link rel="manifest" href="../../../../static/site.webmanifest">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "DiscussionForumPosting",
  "headline": "Fisheye Raycasting",
  "author": {
    "@type": "Person",
    "name": "psioniq"
  },
  "datePublished": "2017-01-05T15:19:39Z",
  "interactionStatistic": {
    "@type": "InteractionCounter",
    "interactionType": "https://schema.org/CommentAction",
    "userInteractionCount": 2
  },
  "isPartOf": {
    "@type": "WebSite",
    "name": "v/programming Archive",
    "url": "https://online-archives.github.io/redd-archiver-example"
  },
  "text": "I'm trying to fake the curvature of a planet using a fisheye post-processing effect, but in doing so, I'll need to transform the rays being cast from screen space (like mouse position), to compensate for the effect. This is how the fisheye post-effect is calculated for the shader (the source and destination are render textures with the same dimensions as the viewport): float oneOverBaseSize = 80.0f / 512.0f; // to keep values more like in the old version of fisheye float ar = (source.width..."
}
</script>
    <!-- Font preload removed - using system fonts for instant rendering -->

    <!-- Theme Toggle -->
    <input type="checkbox" id="dark-theme-toggle">

    <!-- Universal CSS Build -->
    <link rel="stylesheet" href="../../../../static/css/redd-archiver-universal.css">


    <title>v/programming: Fisheye Raycasting</title>
  </head>
  <body>
    <div class="site-content">
<header>
  <nav class="navbar navbar-expand-sm navbar-dark bg-primary">
    <a class="navbar-brand" href="../../../../v/programming/index.html">v/programming</a>
    <input type="checkbox" id="navbar-toggle" class="navbar-toggle">
    <label for="navbar-toggle" class="navbar-toggler" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </label>
    <div class="navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="../../../../v/programming/index.html">score</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../v/programming/index-comments/index.html">comments</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../v/programming/index-date/index.html">date</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../search">search</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../index.html">home</a>
        </li>
        <li class="nav-item">
          <label for="dark-theme-toggle" class="nav-link theme-toggle" title="Toggle dark theme"></label>
        </li>
      </ul>
    </div>
  </nav>
</header>

    <main role="main" class="container-fluid">
<div class="submission pt-3" data-id="voat_1539795">
  <h3 class="title">
      Fisheye Raycasting
    
    
    
    
    
    
  </h3>
  <p>
    <span class="badge badge-primary" title="Score: 2">2</span>
    &nbsp;&nbsp;
    <span title="Posted: 2017-01-05 15:19:39 UTC">05 Jan 2017 15:19</span>
    by <span ><a class="user-link" href="../../../../user/psioniq/">u/psioniq</a>
</span>
    
    
    <span title=""></span>
  </p>
  <div class="card mt-3 mb-3">
    <div class="card-body">
      <div class="md"><p>I'm trying to fake the curvature of a planet using a fisheye post-processing effect, but in doing so, I'll need to transform the rays being cast from screen space (like mouse position), to compensate for the effect.</p>
<p>This is how the fisheye post-effect is calculated for the shader (the <em>source</em> and <em>destination</em> are render textures with the same dimensions as the viewport):</p>
<pre><code>float oneOverBaseSize = 80.0f / 512.0f; // to keep values more like in the old version of fisheye
float ar = (source.width * 1.0f) / (source.height * 1.0f);
fisheyeMaterial.SetVector (&quot;intensity&quot;, new Vector4 (strengthX * ar * oneOverBaseSize, strengthY * oneOverBaseSize, strengthX * ar * oneOverBaseSize, strengthY * oneOverBaseSize));
Graphics.Blit (source, destination, fisheyeMaterial);
</code></pre>
<p>So, how would I go about compensating for that calculation when casting a ray from screen space?</p>
<pre><code>Vector2 mousePos = Input.mousePosition;
// modify mouse position here?
Ray ray = Camera.main.ScreenPointToRay(mousePos);
Physics.SphereCast(ray, pointerSize, out hit, 2000f, mask); // hit contains a point where the ray hit a physical object in the scene
// or modify hit point here?
</code></pre></div>
    </div>
  </div>
</div>

<div class="comments">
  <h4>3 comments</h4>
        <details class="comment "
         id="comment-voat_7495958"
         data-depth="0"
         data-id="voat_7495958"
open>
    <summary class="comment-header">
        <span class="badge badge-success-bright"
              title="Comment score: 1">
            1
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/tame/">u/tame</a>

            </span>
            
            
            
            <span title="Posted: 2017-01-05 17:11:09 UTC">05 Jan 2017 17:11</span>
        </span>
    </summary>
    <div class="md"><p>What are strengthX and strengthY?</p></div>
            <details class="comment "
         id="comment-voat_7496190"
         data-depth="1"
         data-id="voat_7496190"
open>
    <summary class="comment-header">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/psioniq/">u/psioniq</a>

            </span>
                <span class="op-badge" title="Original Poster">[OP]</span>
            
            
            
            <span title="Posted: 2017-01-05 17:27:48 UTC">05 Jan 2017 17:27</span>
        </span>
    </summary>
    <div class="md"><p>They are, in lack of a better term; 'stretching values' - they determine the vertical and horizontal strength of the fisheye effect.</p>
<p>I had a look at the shader and made this solution:</p>
<pre><code>  public static Vector2 FisheyeCoord(Vector2 screenPosition)
    {
        float w = Screen.width;
        float h = Screen.height;
        float oneOverBaseSize = 80.0f / 512.0f; // to keep values more like in the old version of fisheye
        float ar = w / h;
        Vector4 matrix = new Vector4(strengthX * ar * oneOverBaseSize, strengthY * oneOverBaseSize, strengthX * ar * oneOverBaseSize, strengthY * oneOverBaseSize);
        Vector2 mPos = new Vector2(screenPosition.x / w, screenPosition.y / h);
        Vector2 coords = mPos;
        coords = (coords - new Vector2(0.5f, 0.5f)) * 2.0f;
        Vector2 realCoordOffs;
        realCoordOffs.x = (1f - coords.y * coords.y) * matrix.y * (coords.x);
        realCoordOffs.y = (1f - coords.x * coords.x) * matrix.x * (coords.y);
        Vector2 fPos = mPos - realCoordOffs;
        fPos.x *= w;
        fPos.y *= h;
        return fPos;
    }
</code></pre>
<p>Could probably be cleaned up a bit (don't really need a Vector4, as the x/z and y/w values are identical), but it works - thanks for showing interest though :)</p></div>
</details>

</details>

</div>
    </main>

<footer class="container-fluid">
  <a class="to-top mt-1 mb-1 btn btn-lg btn-primary" href="#top">top of page</a>
  <p class="small mb-0">
    last archived 28 Apr 2020
    <a href="https://github.com/19-84/redd-archiver">source code</a>
  </p>
</footer>
    </div>

  </body>
</html>