<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- SEO Meta Tags -->
<meta name="description" content="Hey everyone, this is something I&#39;ve been wrestling with for the last few days. I&#39;m writing an application that reads files and writes them... - v/programming">
<meta name="keywords" content="programming, file, pre, code, filename, return, files, read, like, int">
<meta name="author" content="Redd Archive Demo">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://online-archives.github.io/redd-archiver-example/v/programming/comments/235141.html">

<!-- Open Graph Tags -->
<meta property="og:title" content="v/programming: C/C++ and large file sizes (over 2GB)">
<meta property="og:description" content="Hey everyone, this is something I&#39;ve been wrestling with for the last few days. I&#39;m writing an application that reads files and writes them... - v/programming">
<meta property="og:type" content="article">
<meta property="og:url" content="https://online-archives.github.io/redd-archiver-example/v/programming/comments/235141.html">
<meta property="og:site_name" content="Redd Archive Demo">

<!-- Twitter Card Tags -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="v/programming: C/C++ and large file sizes (over 2GB)">
<meta name="twitter:description" content="Hey everyone, this is something I&#39;ve been wrestling with for the last few days. I&#39;m writing an application that reads files and writes them... - v/programming">

    <!-- Favicon -->
<link rel="icon" href="../../../../static/favicon.ico" sizes="32x32">
    <link rel="icon" href="../../../../static/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="../../../../static/apple-touch-icon.png">
    <link rel="manifest" href="../../../../static/site.webmanifest">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "DiscussionForumPosting",
  "headline": "C/C++ and large file sizes (over 2GB)",
  "author": {
    "@type": "Person",
    "name": "RiderRockon"
  },
  "datePublished": "2015-07-09T23:59:43Z",
  "interactionStatistic": {
    "@type": "InteractionCounter",
    "interactionType": "https://schema.org/CommentAction",
    "userInteractionCount": 1
  },
  "isPartOf": {
    "@type": "WebSite",
    "name": "v/programming Archive",
    "url": "https://online-archives.github.io/redd-archiver-example"
  },
  "text": "Hey everyone, this is something I've been wrestling with for the last few days. I'm writing an application that reads files and writes them out again. There's some data manipulation happening, but that's not relevant for this topic. The big issue I keep running into is that I can't find a reliable way to get the file's size without having to read every byte of it, which is really slow. There seem to be 2 primary methods to get the file size, according to what I've found through Google on places..."
}
</script>
    <!-- Font preload removed - using system fonts for instant rendering -->

    <!-- Theme Toggle -->
    <input type="checkbox" id="dark-theme-toggle">

    <!-- Universal CSS Build -->
    <link rel="stylesheet" href="../../../../static/css/redd-archiver-universal.css">


    <title>v/programming: C/C++ and large file sizes (over 2GB)</title>
  </head>
  <body>
    <div class="site-content">
<header>
  <nav class="navbar navbar-expand-sm navbar-dark bg-primary">
    <a class="navbar-brand" href="../../../../v/programming/index.html">v/programming</a>
    <input type="checkbox" id="navbar-toggle" class="navbar-toggle">
    <label for="navbar-toggle" class="navbar-toggler" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </label>
    <div class="navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="../../../../v/programming/index.html">score</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../v/programming/index-comments/index.html">comments</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../v/programming/index-date/index.html">date</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../search">search</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../index.html">home</a>
        </li>
        <li class="nav-item">
          <label for="dark-theme-toggle" class="nav-link theme-toggle" title="Toggle dark theme"></label>
        </li>
      </ul>
    </div>
  </nav>
</header>

    <main role="main" class="container-fluid">
<div class="submission pt-3" data-id="voat_235141">
  <h3 class="title">
      C/C++ and large file sizes (over 2GB)
    
    
    
    
    
    
  </h3>
  <p>
    <span class="badge badge-primary" title="Score: 1">1</span>
    &nbsp;&nbsp;
    <span title="Posted: 2015-07-09 23:59:43 UTC">09 Jul 2015 23:59</span>
    by <span ><a class="user-link" href="../../../../user/RiderRockon/">u/RiderRockon</a>
</span>
    
    
    <span title=""></span>
  </p>
  <div class="card mt-3 mb-3">
    <div class="card-body">
      <div class="md"><p>Hey everyone, this is something I've been wrestling with for the last few days. I'm writing an application that reads files and writes them out again. There's some data manipulation happening, but that's not relevant for this topic.</p>
<p>The big issue I keep running into is that I can't find a reliable way to get the file's size without having to read every byte of it, which is really slow. There seem to be 2 primary methods to get the file size, according to what I've found through Google on places like StackOverflow.</p>
<p><strong>Method 1:</strong></p>
<pre><code>int getFileSize(const std::string &amp;fileName)
{
    ifstream file(fileName.c_str(), ifstream::binary);
    file.seekg(0, ios::end);
    int fileSize = file.tellg();
    file.close();
    return fileSize;
}
</code></pre>
<p><strong>Method 2:</strong></p>
<pre><code>struct stat st;
    if(stat(filename.c_str(), &amp;st) != 0) {
        return 0;
    }
    return st.st_size;  
</code></pre>
<p>Both of these have their problems in handling larger file sizes. I found with the first method that, even when using a datatype large enough to hold the size (like a <strong>long long</strong>) it still wraps around at around the 2GB mark. The second method does not have this ailment, but becomes oddly inaccurate at larger file sizes.</p>
<p>I've read about the existence of stat64 being able to work with large file types, but aside from a few references I couldn't find anything concrete on how that was supposed to work. </p>
<p>Now, provided you don't want to delve into platform-specific functions, what would be the best way to accurately get a file's size for small and large files?</p></div>
    </div>
  </div>
</div>

<div class="comments">
  <h4>6 comments</h4>
        <details class="comment "
         id="comment-voat_738796"
         data-depth="0"
         data-id="voat_738796"
open>
    <summary class="comment-header">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/sulami/">u/sulami</a>

            </span>
            
            
            
            <span title="Posted: 2015-07-10 00:11:49 UTC">10 Jul 2015 00:11</span>
        </span>
    </summary>
    <div class="md"><p>So, according to <a href="https://stackoverflow.com/questions/8236/how-do-you-determine-the-size-of-a-file-in-c">this</a> you need to use <code>off_t</code>, and compile with <code>-D_FILE_OFFSET_BITS=64</code> if you are on a 32-bit system (using method 2). That is supposed to work on any platform.</p></div>
            <details class="comment "
         id="comment-voat_763769"
         data-depth="1"
         data-id="voat_763769"
open>
    <summary class="comment-header">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/RiderRockon/">u/RiderRockon</a>

            </span>
                <span class="op-badge" title="Original Poster">[OP]</span>
            
            
            
            <span title="Posted: 2015-07-10 09:32:15 UTC">10 Jul 2015 09:32</span>
        </span>
    </summary>
    <div class="md"><p>I gave that a shot. However when I run this on a large file it returns -1. I'm using MinGW on Windows for this, but that shouldn't matter, should it?</p></div>
            <details class="comment "
         id="comment-voat_764031"
         data-depth="2"
         data-id="voat_764031"
open>
    <summary class="comment-header">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/sulami/">u/sulami</a>

            </span>
            
            
            
            <span title="Posted: 2015-07-10 09:43:50 UTC">10 Jul 2015 09:43</span>
        </span>
    </summary>
    <div class="md"><p><code>I'm using MinGW on Windows for this, but that shouldn't matter, should it?</code></p>
<p>I don't think so. If you paste the whole section of whatever you wrote, I could throw it into a compiler here and check if I can find something odd.</p></div>
            <details class="comment "
         id="comment-voat_765245"
         data-depth="3"
         data-id="voat_765245"
open>
    <summary class="comment-header">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/RiderRockon/">u/RiderRockon</a>

            </span>
                <span class="op-badge" title="Original Poster">[OP]</span>
            
            
            
            <span title="Posted: 2015-07-10 10:34:10 UTC">10 Jul 2015 10:34</span>
        </span>
    </summary>
    <div class="md"><p>After a bit of digging I think I might be doing something wrong with the compiler flag, as sizeof( off_t ) still returns 4. Here's what I use to compile the project.</p>
<pre><code>gcc -c src/cryption.cpp -I include -L lib -D_FILE_OFFSET_BITS=64
gcc -c src/main.cpp -I include -L lib -D_FILE_OFFSET_BITS=64
echo ----------------
g++ -o cryption main.o cryption.o -I include -L lib -D_FILE_OFFSET_BITS=64
</code></pre></div>
            <details class="comment "
         id="comment-voat_765738"
         data-depth="4"
         data-id="voat_765738"
open>
    <summary class="comment-header">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/sulami/">u/sulami</a>

            </span>
            
            
            
            <span title="Posted: 2015-07-10 10:55:23 UTC">10 Jul 2015 10:55</span>
        </span>
    </summary>
    <div class="md"><p>So on 64-bit Linux this give me 8 bytes, so 64 bits, regardless of whether I use <code>-D_FILE_OFFSET__BITS=64</code>, as expected.</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;sys/stat.h&gt;
int
main()
{
    off_t size;
    printf(&quot;%d\n&quot;, sizeof(size));
    return 0;
}
</code></pre>
<p>I did some more quick searching and found <a href="https://stackoverflow.com/questions/12539488/determine-64-bit-file-size-in-c-on-mingw-32-bit">this</a>, where OP found a MinGW-specific solution that involves a 64-bit stat struct, afaict.</p></div>
            <details class="comment "
         id="comment-voat_769942"
         data-depth="5"
         data-id="voat_769942"
open>
    <summary class="comment-header">
        <span class="badge badge-success-bright"
              title="Comment score: 1">
            1
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/RiderRockon/">u/RiderRockon</a>

            </span>
                <span class="op-badge" title="Original Poster">[OP]</span>
            
            
            
            <span title="Posted: 2015-07-10 13:47:24 UTC">10 Jul 2015 13:47</span>
        </span>
    </summary>
    <div class="md"><p>Yes! That seems to work for me as well! Thank you!</p>
<p>That seems a rather oddly specific way to do it though.</p></div>
</details>

</details>

</details>

</details>

</details>

</details>

</div>
    </main>

<footer class="container-fluid">
  <a class="to-top mt-1 mb-1 btn btn-lg btn-primary" href="#top">top of page</a>
  <p class="small mb-0">
    last archived 28 Apr 2020
    <a href="https://github.com/19-84/redd-archiver">source code</a>
  </p>
</footer>
    </div>

  </body>
</html>