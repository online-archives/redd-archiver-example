<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- SEO Meta Tags -->
<meta name="description" content="I&#39;ve been working on a video surveillance project for the raspberry pi and finally got around to posting the code. It&#39;s written in C++ and... - v/programming">
<meta name="keywords" content="programming, raspberry, video, surveillance, github, pisentinel, project, finally, posting, code">
<meta name="author" content="Redd Archive Demo">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://online-archives.github.io/redd-archiver-example/v/programming/comments/2105851.html">

<!-- Open Graph Tags -->
<meta property="og:title" content="v/programming: Raspberry Pi video surveillance">
<meta property="og:description" content="I&#39;ve been working on a video surveillance project for the raspberry pi and finally got around to posting the code. It&#39;s written in C++ and... - v/programming">
<meta property="og:type" content="article">
<meta property="og:url" content="https://online-archives.github.io/redd-archiver-example/v/programming/comments/2105851.html">
<meta property="og:site_name" content="Redd Archive Demo">

<!-- Twitter Card Tags -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="v/programming: Raspberry Pi video surveillance">
<meta name="twitter:description" content="I&#39;ve been working on a video surveillance project for the raspberry pi and finally got around to posting the code. It&#39;s written in C++ and... - v/programming">

    <!-- Favicon -->
<link rel="icon" href="../../../../static/favicon.ico" sizes="32x32">
    <link rel="icon" href="../../../../static/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="../../../../static/apple-touch-icon.png">
    <link rel="manifest" href="../../../../static/site.webmanifest">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "DiscussionForumPosting",
  "headline": "Raspberry Pi video surveillance",
  "author": {
    "@type": "Person",
    "name": "kevf4"
  },
  "datePublished": "2017-09-04T03:55:15Z",
  "interactionStatistic": {
    "@type": "InteractionCounter",
    "interactionType": "https://schema.org/CommentAction",
    "userInteractionCount": 8
  },
  "isPartOf": {
    "@type": "WebSite",
    "name": "v/programming Archive",
    "url": "https://online-archives.github.io/redd-archiver-example"
  },
  "text": "I've been working on a video surveillance project for the raspberry pi and finally got around to posting the code. It's written in C++ and uses ASIO, OpenGL, and libjpeg-turbo to do a lot of the heavy lifting. Let me know what you think. https://github.com/kevf4/pisentinel"
}
</script>
    <!-- Font preload removed - using system fonts for instant rendering -->

    <!-- Theme Toggle -->
    <input type="checkbox" id="dark-theme-toggle">

    <!-- Universal CSS Build -->
    <link rel="stylesheet" href="../../../../static/css/redd-archiver-universal.css">


    <title>v/programming: Raspberry Pi video surveillance</title>
  </head>
  <body>
    <div class="site-content">
<header>
  <nav class="navbar navbar-expand-sm navbar-dark bg-primary">
    <a class="navbar-brand" href="../../../../v/programming/index.html">v/programming</a>
    <input type="checkbox" id="navbar-toggle" class="navbar-toggle">
    <label for="navbar-toggle" class="navbar-toggler" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </label>
    <div class="navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="../../../../v/programming/index.html">score</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../v/programming/index-comments/index.html">comments</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../v/programming/index-date/index.html">date</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../search">search</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../../../../index.html">home</a>
        </li>
        <li class="nav-item">
          <label for="dark-theme-toggle" class="nav-link theme-toggle" title="Toggle dark theme"></label>
        </li>
      </ul>
    </div>
  </nav>
</header>

    <main role="main" class="container-fluid">
<div class="submission pt-3" data-id="voat_2105851">
  <h3 class="title">
      Raspberry Pi video surveillance
    
    
    
    
    
    
  </h3>
  <p>
    <span class="badge badge-primary" title="Score: 3">3</span>
    &nbsp;&nbsp;
    <span title="Posted: 2017-09-04 03:55:15 UTC">04 Sep 2017 03:55</span>
    by <span ><a class="user-link" href="../../../../user/kevf4/">u/kevf4</a>
</span>
    
    
    <span title=""></span>
  </p>
  <div class="card mt-3 mb-3">
    <div class="card-body">
      <div class="md"><p>I've been working on a video surveillance project for the raspberry pi and finally got around to posting the code.  It's written in C++ and uses ASIO, OpenGL, and libjpeg-turbo to do a lot of the heavy lifting.  Let me know what you think.</p>
<p><a href="https://github.com/kevf4/pisentinel">https://github.com/kevf4/pisentinel</a></p></div>
    </div>
  </div>
</div>

<div class="comments">
  <h4>16 comments</h4>
        <details class="comment "
         id="comment-voat_10383054"
         data-depth="0"
         data-id="voat_10383054"
open>
    <summary class="comment-header">
        <span class="badge badge-success-bright"
              title="Comment score: 12">
            12
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/Palaver/">u/Palaver</a>

            </span>
            
            
            
            <span title="Posted: 2017-09-04 04:26:02 UTC">04 Sep 2017 04:26</span>
        </span>
    </summary>
    <div class="md"><p>Impressive bit of work there. Found it pretty readable at first run through (which surprised me considering how long it has been since I've touched c++). </p>
<p>I would recommend moving to a different git host though, GitHub has banned developers for unpopular speech on a few occasions. Bitbucket is a little better, and still free. Others exist (gitlab is completely open source I believe).</p></div>
            <details class="comment "
         id="comment-voat_10386191"
         data-depth="1"
         data-id="voat_10386191"
open>
    <summary class="comment-header">
        <span class="badge badge-success"
              title="Comment score: 1">
            1
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/Xicronic/">u/Xicronic</a>

            </span>
            
            
            
            <span title="Posted: 2017-09-04 15:51:49 UTC">04 Sep 2017 15:51</span>
        </span>
    </summary>
    <div class="md"><p>I second GitLab. They don't support full free speech, but they are fully open source and have free private repos.</p></div>
</details>

</details>

        <details class="comment "
         id="comment-voat_10383063"
         data-depth="0"
         data-id="voat_10383063"
open>
    <summary class="comment-header">
        <span class="badge badge-success"
              title="Comment score: 1">
            1
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/BentAxel/">u/BentAxel</a>

            </span>
            
            
            
            <span title="Posted: 2017-09-04 04:27:00 UTC">04 Sep 2017 04:27</span>
        </span>
    </summary>
    <div class="md"><p>Mother Effer. It tracks the objects in the frame? That's some super cool stuff.</p></div>
</details>

        <details class="comment "
         id="comment-voat_10383237"
         data-depth="0"
         data-id="voat_10383237"
open>
    <summary class="comment-header">
        <span class="badge badge-success"
              title="Comment score: 1">
            1
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/KikeFree/">u/KikeFree</a>

            </span>
            
            
            
            <span title="Posted: 2017-09-04 04:54:52 UTC">04 Sep 2017 04:54</span>
        </span>
    </summary>
    <div class="md"><p>I made a system for networked H264 cameras, with realtime tracking of multiple targets that works well.</p>
<p>So, some comments from my experience that might be helpful:</p>
<p>Where these things usually fall down, particularly with multiple HD streams is from the load on the CPUs.</p>
<p>I highly recommend reading and decoding the full resolution stream into a framebuffer (looks like you get jpegs) (generally you want the full frames saved for the record if motion is detected anyway), make a lower resolution copy of the frame buffer to run your motion detection/tracking algorithms on (cubic or linear interpolation).  Multiple passes of gaussian blur with a running average frame subtracted from the live image, combined with a hole filling algorithm will produce blobs that cover anything moving.  You can measure the blob sizes to discard  blowing leaves, or massive shadows from moving clouds, and finding the center of the blobs for targeting/tracking purposes is trivial.  Use a mask image the same dimensions in concert with your highly optimized gaussian blur algorithm to avoid calculations on pixels outside of your interest.</p>
<p>Reduce your stream buffer size to a minimum to keep tracking lag to a minimum.</p>
<p>I haven't open sourced it, but maybe one day.</p></div>
            <details class="comment "
         id="comment-voat_10383456"
         data-depth="1"
         data-id="voat_10383456"
open>
    <summary class="comment-header">
        <span class="badge badge-success"
              title="Comment score: 1">
            1
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/kevf4/">u/kevf4</a>

            </span>
                <span class="op-badge" title="Original Poster">[OP]</span>
            
            
            
            <span title="Posted: 2017-09-04 05:27:04 UTC">04 Sep 2017 05:27</span>
        </span>
    </summary>
    <div class="md"><p>You're right about HD processing being an issue.  I've worked on a system used for airports and prisons, and they usually have two streams per optical camera.  One HD stream that goes to the VMS and another low res stream for object detection + onvif metadata generation.  This was just a hobby project for learning and I didn't want to go all-in, otherwise I would have used ffmpeg or opencv.</p>
<p>For blob detection I'm just using a simple depth-first algorithm and culling based on user parameters and a heatmap of negatively scored detections.  I tried using random forests for culling, but the algorithm required a bit too much tweaking to get it to work correctly.  A few people I work with have researched SVMs and deep learning networks, but those required a massive amount of data that I'm not too interested in collecting.</p></div>
            <details class="comment "
         id="comment-voat_10383520"
         data-depth="2"
         data-id="voat_10383520"
open>
    <summary class="comment-header">
        <span class="badge badge-success"
              title="Comment score: 1">
            1
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/KikeFree/">u/KikeFree</a>

            </span>
            
            
            
            <span title="Posted: 2017-09-04 05:38:41 UTC">04 Sep 2017 05:38</span>
        </span>
    </summary>
    <div class="md"><p>More than one camera can help reject false positives like rain drops or blowing snow.  
</p>
<p>When it comes down to intelligently rejecting movement, the probable identity of the object needs to be determined, and it's so difficult even a human watching can reject legitimate movement or needs a double-take to figure out wtf it was that changed.  For some things thermal imaging can help.  I don't think conventional deep learning is the way forward, I lean towards making progress on nested pattern recognition.</p></div>
</details>

</details>

</details>

        <details class="comment "
         id="comment-voat_10386461"
         data-depth="0"
         data-id="voat_10386461"
open>
    <summary class="comment-header">
        <span class="badge badge-success"
              title="Comment score: 1">
            1
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/1moar/">u/1moar</a>

            </span>
            
            
            
            <span title="Posted: 2017-09-04 16:25:01 UTC">04 Sep 2017 16:25</span>
        </span>
    </summary>
    <div class="md"><p>Saved, thanks mate.</p></div>
</details>

        <details class="comment "
         id="comment-voat_10386536"
         data-depth="0"
         data-id="voat_10386536"
open>
    <summary class="comment-header">
        <span class="badge badge-success"
              title="Comment score: 1">
            1
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/hedidnothingwrong/">u/hedidnothingwrong</a>

            </span>
            
            
            
            <span title="Posted: 2017-09-04 16:35:08 UTC">04 Sep 2017 16:35</span>
        </span>
    </summary>
    <div class="md"><p>Hello, I've got a few questions,</p>
<p>Why didn't you use Opencv?</p>
<p>What kind of algorithm do you use? I guess it's probably some background subtraction algorithm, do you have any links (papers)?</p>
<p>Thank you in advance.</p></div>
            <details class="comment "
         id="comment-voat_10387501"
         data-depth="1"
         data-id="voat_10387501"
open>
    <summary class="comment-header">
        <span class="badge badge-success"
              title="Comment score: 1">
            1
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/kevf4/">u/kevf4</a>

            </span>
                <span class="op-badge" title="Original Poster">[OP]</span>
            
            
            
            <span title="Posted: 2017-09-04 18:28:52 UTC">04 Sep 2017 18:28</span>
        </span>
    </summary>
    <div class="md"><p>The reason I didn't use OpenCV is because I used this project for learning and I wanted to try some new approaches.  Also, I wasn't sure how well OpenCV would perform on a Raspberry Pi .  I'm using OpenGL shaders for processing when possible.</p>
<p>The function Analytics::update in Analytics.cpp on line 637 gives a high level overview of the detection algorithms.  In a nutshell:</p>
<ul>
<li>
<p>A background frame is calculated which is the average of frames over the last few minutes.  This may change to a Gaussian distribution to reduce spikes, but so far simple averaging is working well.   (see Shaders::incrementShaderSource at Shaders.cpp line 141).</p>
</li>
<li>
<p>The current frame frame is then subtracted from the background frame, which generates a motion mask.  (see Shaders::motionMaskShaderSource at Shaders.cpp line 102).</p>
</li>
<li>
<p>Blobs are detected within the motion mask by using a depth first search.  (see Analytics::_detectObjects at Analytics.cpp line 91).</p>
</li>
<li>
<p>Blobs are tracked using a simple distanced based approach.  (see Analytics::_trackObjects at Analytics.cpp line 284).</p>
</li>
<li>
<p>When a user &quot;trains&quot; the system it is essentially creating a heatmap with thresholds.  If the heatmap has a &quot;hot&quot; spot, this tells the algorithm to ignore alarms in that area.  (see ExclusionZones.cpp)</p>
</li>
</ul>
<p>I don't have any documentation or diagrams.  This project was never really intended for public use, but I am sharing because it could be useful to someone.</p></div>
            <details class="comment "
         id="comment-voat_10387942"
         data-depth="2"
         data-id="voat_10387942"
open>
    <summary class="comment-header">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/hedidnothingwrong/">u/hedidnothingwrong</a>

            </span>
            
            
            
            <span title="Posted: 2017-09-04 19:24:28 UTC">04 Sep 2017 19:24</span>
        </span>
    </summary>
    <div class="md"><p>Thanks, it was a very clear explanation.</p></div>
</details>

</details>

</details>

        <details class="comment "
         id="comment-voat_10386455"
         data-depth="0"
         data-id="voat_10386455"
open>
    <summary class="comment-header">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/brianforward/">u/brianforward</a>

            </span>
            
            
            
            <span title="Posted: 2017-09-04 16:23:05 UTC">04 Sep 2017 16:23</span>
        </span>
    </summary>
    <div class="md"><p>It doesn't open..<a href="http://houston-girls.com">.</a></p></div>
</details>

        <details class="comment "
         id="comment-voat_10387898"
         data-depth="0"
         data-id="voat_10387898"
open>
    <summary class="comment-header">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/ThisIsntMe123/">u/ThisIsntMe123</a>

            </span>
            
            
            
            <span title="Posted: 2017-09-04 19:19:55 UTC">04 Sep 2017 19:19</span>
        </span>
    </summary>
    <div class="md"><p>How is this different from MotionEyeOS or whatever?</p></div>
            <details class="comment "
         id="comment-voat_10388674"
         data-depth="1"
         data-id="voat_10388674"
open>
    <summary class="comment-header">
        <span class="badge badge-success"
              title="Comment score: 1">
            1
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/kevf4/">u/kevf4</a>

            </span>
                <span class="op-badge" title="Original Poster">[OP]</span>
            
            
            
            <span title="Posted: 2017-09-04 20:50:21 UTC">04 Sep 2017 20:50</span>
        </span>
    </summary>
    <div class="md"><p>I don't have any experience with MotionEyeOS, but it looks very similar.  My project (pisentinel) supports SeekThermal cameras, IP MJPEG cameras, has a training mode to prevent false alarms, and supports up to 720p frame processing.  I will try to throw together a video sometime this week that breaks down the features.</p></div>
            <details class="comment "
         id="comment-voat_10388910"
         data-depth="2"
         data-id="voat_10388910"
open>
    <summary class="comment-header">
        <span class="badge badge-warning-orange"
              title="Comment score: 0">
            0
        </span>
        <span class="byline text-muted">
            <span >
                <a class="user-link" href="../../../../user/ThisIsntMe123/">u/ThisIsntMe123</a>

            </span>
            
            
            
            <span title="Posted: 2017-09-04 21:14:46 UTC">04 Sep 2017 21:14</span>
        </span>
    </summary>
    <div class="md"><p>Optional cloud/ftp backup would be cool.</p></div>
</details>

</details>

</details>

</div>
    </main>

<footer class="container-fluid">
  <a class="to-top mt-1 mb-1 btn btn-lg btn-primary" href="#top">top of page</a>
  <p class="small mb-0">
    last archived 28 Apr 2020
    <a href="https://github.com/19-84/redd-archiver">source code</a>
  </p>
</footer>
    </div>

  </body>
</html>